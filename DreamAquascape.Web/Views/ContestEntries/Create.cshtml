@model DreamAquascape.Web.ViewModels.ContestEntry.CreateContestEntryViewModel

@{
    ViewData["Title"] = "Submit Your Aquascape Entry";
}

<div class="container my-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">Submit Your Aquascape Entry</h2>
        </div>
        <div class="card-body">
            <form asp-action="Create" enctype="multipart/form-data" method="post" novalidate>
                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                <!-- Multiple Image Upload -->
                <div class="mb-3">
                    <label for="ImageFiles" class="form-label fw-bold">
                        Upload Photos <span class="text-danger">*</span>
                    </label>
                    <input class="form-control" type="file" id="ImageFiles" name="ImageFiles" accept="image/*" multiple required
                           onchange="previewImages(event)">
                    <div class="form-text">You can upload 1 to 3 images.</div>
                    <div class="invalid-feedback">Please upload at least one photo (max 3).</div>
                </div>
                <!-- Image Previews -->
                <div class="mb-4" id="imagePreviewContainer" style="display:none;">
                    <p class="fw-semibold mb-1">Preview:</p>
                    <div id="imagePreviewList" class="d-flex gap-3 flex-wrap"></div>
                </div>

                <!-- Title -->
                <div class="mb-3">
                    <label for="Title" class="form-label fw-bold">
                        Entry Title <span class="text-danger">*</span>
                    </label>
                    <input asp-for="Title" class="form-control" id="Title" required>
                    <span asp-validation-for="Title" class="text-danger"></span>
                </div>

                <!-- Description -->
                <div class="mb-3">
                    <label for="Description" class="form-label fw-bold">
                        Description <span class="text-danger">*</span>
                    </label>
                    <textarea asp-for="Description" class="form-control" id="Description" rows="4" required></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>

                <!-- Hidden Contest ID -->
                <input type="hidden" asp-for="ContestId">

                <!-- Submit Button -->
                <div class="row">
                    <div class="col">
                        <a class="btn btn-secondary btn-lg w-100" href="/Contests/Details/@Model.ContestId">Cancel</a>
                    </div>
                    <div class="col">
                        <button type="submit" class="btn btn-primary btn-lg w-100">Submit Entry</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Show previews for multiple images, limit to 3
        function previewImages(event) {
            const input = event.target;
            const previewContainer = document.getElementById('imagePreviewContainer');
            const previewList = document.getElementById('imagePreviewList');
            previewList.innerHTML = '';

            if (input.files && input.files.length > 0) {
                const files = Array.from(input.files).slice(0, 3); // Max 3 images

                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'img-fluid rounded border';
                        img.style.maxHeight = '150px';
                        img.style.objectFit = 'cover';
                        previewList.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });

                previewContainer.style.display = 'block';
            } else {
                previewContainer.style.display = 'none';
            }
        }

        // Optional: Prevent selecting more than 3 files
        document.getElementById('ImageFiles').addEventListener('change', function(e) {
            if (this.files.length > 3) {
                alert('You can upload a maximum of 3 images.');
                this.value = '';
                document.getElementById('imagePreviewContainer').style.display = 'none';
            }
        });
    </script>
}
